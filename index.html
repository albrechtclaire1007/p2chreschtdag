<!DOCTYPE html>
<html lang="lb">
<head>
  <meta charset="UTF-8">
  <title>P2 ‚Äì Chr√´schtdag Vokabeltrainer + Bam faarwen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --green-dark: #387c44;
      --green-light: #dff4e4;
      --green-medium: #86c99b;
      --accent: #f8f1c7;
      --card-bg: #ffffff;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Schoulschr√´ft", "Comic Sans MS", system-ui, sans-serif;
      background: var(--green-light);
      color: #222;
    }

    #app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }

    header {
      background: var(--green-dark);
      color: white;
      padding: 0.8rem 1rem;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    header h1 {
      margin: 0;
      font-size: 1.6rem;
    }

    header p {
      margin: 0.2rem 0 0;
      font-size: 0.9rem;
    }

    .menu-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    button {
      font-family: inherit;
      font-size: 1rem;
      padding: 0.6rem 0.8rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: var(--green-medium);
      color: #103116;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.18);
      background: #71b88a;
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }

    .btn-secondary {
      background: #ffffff;
      border: 2px solid var(--green-medium);
    }

    .screen {
      display: none;
      background: rgba(255,255,255,0.9);
      border-radius: 16px;
      padding: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .screen.active { display: block; }

    .screen h2 {
      margin-top: 0;
      text-align: center;
      color: var(--green-dark);
    }

    .instructions {
      text-align: center;
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }

    .status {
      font-size: 0.9rem;
      background: var(--accent);
      padding: 0.4rem 0.7rem;
      border-radius: 999px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 0.8rem;
      margin-top: 0.5rem;
    }

    .card {
      background: var(--card-bg);
      border-radius: 14px;
      padding: 0.5rem;
      text-align: center;
      box-shadow: 0 3px 6px rgba(0,0,0,0.12);
      position: relative;
    }

    .card img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto 0.3rem;
    }

    .card-label {
      font-size: 0.95rem;
      margin-top: 0.2rem;
    }

    /* Lauschter a Klick */
    .clickable-card {
      cursor: pointer;
      border: 3px solid transparent;
    }

    .clickable-card.correct {
      border-color: #3ba55d;
      box-shadow: 0 0 0 3px rgba(59,165,93,0.4);
    }

    .clickable-card.wrong {
      border-color: #e55353;
      box-shadow: 0 0 0 3px rgba(229,83,83,0.4);
    }

    /* Memory */
    .memory-grid {
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
    }

    .memory-card {
      height: 110px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      border-radius: 10px;
      background: var(--green-medium);
      color: #103116;
      font-size: 0.9rem;
      position: relative;
      user-select: none;
    }

    .memory-card.revealed,
    .memory-card.matched {
      background: var(--card-bg);
    }

    .memory-card img {
      max-width: 80%;
      max-height: 80%;
    }

    .memory-card.matched {
      border: 3px solid #3ba55d;
      box-shadow: 0 0 0 3px rgba(59,165,93,0.4);
      cursor: default;
    }

    /* Schreif d'Wuert */
    .write-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
      margin-top: 0.5rem;
    }

    .write-image {
      max-width: 180px;
      width: 40vw;
    }

    .write-input {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .write-input input {
      font-family: inherit;
      font-size: 1.1rem;
      padding: 0.4rem 0.6rem;
      border-radius: 8px;
      border: 2px solid var(--green-medium);
      min-width: 180px;
    }

    .feedback {
      min-height: 1.2rem;
      font-size: 0.95rem;
      text-align: center;
      margin-top: 0.2rem;
    }

    /* Riddles */
    .riddle-box {
      background: var(--accent);
      border-radius: 14px;
      padding: 0.7rem;
      margin-bottom: 0.7rem;
      font-size: 0.95rem;
      text-align: center;
    }

    .riddle-images {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: 0.7rem;
    }

    .riddle-card {
      cursor: pointer;
      border: 3px solid transparent;
    }

    .riddle-card.correct {
      border-color: #3ba55d;
      box-shadow: 0 0 0 3px rgba(59,165,93,0.4);
    }

    .riddle-card.wrong {
      border-color: #e55353;
      box-shadow: 0 0 0 3px rgba(229,83,83,0.4);
    }

    /* ----- Decorate the Tree ----- */
    .tree-layout {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      align-items: flex-start;
      margin-top: 0.5rem;
    }

    .tree-container {
      background: #e8f7ec;
      border-radius: 16px;
      padding: 0.7rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }

    .tree-svg {
      width: 260px;
      max-width: 80vw;
      height: auto;
      display: block;
    }

    .palette-container {
      min-width: 220px;
      max-width: 320px;
    }

    .palette-title {
      font-size: 0.9rem;
      margin-bottom: 0.3rem;
      text-align: center;
    }

    .color-palette {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      justify-content: center;
      margin-bottom: 0.5rem;
    }

    .palette-color {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 3px solid transparent;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.18);
    }

    .palette-color.selected {
      border-color: #222;
      box-shadow: 0 0 0 3px rgba(34,34,34,0.4);
    }

    .exercise-text {
      background: var(--accent);
      border-radius: 12px;
      padding: 0.5rem 0.7rem;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .tree-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      justify-content: center;
      margin-top: 0.4rem;
    }

    .ornament {
      cursor: pointer;
      stroke: #555;
      stroke-width: 1.8;
    }

    .ornament.bauble {
      fill: #ffffff;
    }

    .ornament.light {
      fill: #ffffff;
      stroke-dasharray: 2 1;
    }

    .star-shape {
      fill: #f9e36b;
      stroke: #e1c64f;
      stroke-width: 2;
    }

    @media (max-width: 600px) {
      header h1 { font-size: 1.3rem; }
      .menu-buttons { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
<div id="app">
  <header>
    <h1>P2 ‚Äì Chr√´schtdag</h1>
    <p>Greenspiller mat Schoulschr√´ft ‚Äì Lauschteren, Lies- a Schreif√ºbungen + Bam faarwen</p>
  </header>

  <!-- Hauptmen√º -->
  <div class="menu-buttons">
    <button onclick="showScreen('lauschter')">üéß Lauschter a Klick</button>
    <button onclick="showScreen('memory')">üß† Memory</button>
    <button onclick="showScreen('schreif')">‚úèÔ∏è Schreif d'Wuert</button>
    <button onclick="showScreen('raetsel')">‚ùì Wien oder wat sinn ech?</button>
    <button onclick="showScreen('decor')">üéÑ Bam faarwen</button>
  </div>

  <!-- Lauschter a Klick -->
  <section id="screen-lauschter" class="screen">
    <div class="top-bar">
      <h2>üéß Lauschter a klick</h2>
      <div class="status" id="lauschter-status">Punkten: <span id="lauschter-score">0</span></div>
      <button class="btn-secondary" onclick="playCurrentAudio()">üîÅ Nolauschteren</button>
      <button class="btn-secondary" onclick="startLauschterRound()">‚ñ∂Ô∏è Nei Wuert</button>
    </div>
    <p class="instructions">Lauschter d'Wuert a klick op dat richtegt Bild.</p>
    <div id="lauschter-grid" class="grid"></div>
    <div class="feedback" id="lauschter-feedback"></div>
  </section>

  <!-- Memory -->
  <section id="screen-memory" class="screen">
    <div class="top-bar">
      <h2>üß† Memory</h2>
      <div class="status" id="memory-status">Paaren: <span id="memory-found">0</span>/12</div>
      <button class="btn-secondary" onclick="startMemoryGame()">üîÅ Nei Spill</button>
    </div>
    <p class="instructions">Fann d'Paaren: Bild a Wuert passen zesummen.</p>
    <div id="memory-grid" class="grid memory-grid"></div>
    <div class="feedback" id="memory-feedback"></div>
  </section>

  <!-- Schreif d'Wuert -->
  <section id="screen-schreif" class="screen">
    <div class="top-bar">
      <h2>‚úèÔ∏è Schreif d'Wuert</h2>
      <div class="status">Ronn: <span id="write-round">1</span></div>
      <button class="btn-secondary" onclick="startWriteGame()">üîÅ Nei Spill</button>
    </div>
    <p class="instructions">Kuck d'Bild, lauschter d'Audio a schreif d'Wuert.</p>
    <div class="write-wrap">
      <img id="write-image" class="write-image" src="" alt="">
      <div class="write-input">
        <input id="write-input" type="text" autocomplete="off" placeholder="Hei d'Wuert schreiwen ‚Ä¶">
        <button onclick="playWriteAudio()">üéß Lauschteren</button>
        <button onclick="checkWriteAnswer()">‚úÖ Kontroll√©ieren</button>
        <button class="btn-secondary" onclick="nextWriteRound()">‚û°Ô∏è Weider</button>
      </div>
      <div class="feedback" id="write-feedback"></div>
    </div>
  </section>

  <!-- R√§tselspill -->
  <section id="screen-raetsel" class="screen">
    <div class="top-bar">
      <h2>‚ùì Wien oder wat sinn ech?</h2>
      <div class="status">R√§tsel: <span id="riddle-count">1</span>/6</div>
      <button class="btn-secondary" onclick="startRiddleGame()">üîÅ Nei Spill</button>
    </div>
    <p class="instructions">Lies (oder lauschter) d'Text an da klick op dat richtegt Bild.</p>
    <div class="riddle-box" id="riddle-text"></div>
    <div class="riddle-images" id="riddle-images"></div>
    <div class="feedback" id="riddle-feedback"></div>
  </section>

  <!-- Bam faarwen -->
  <section id="screen-decor" class="screen">
    <div class="top-bar">
      <h2>üéÑ Bam faarwen</h2>
      <div class="status">√úbung: <span id="decor-ex-index">1</span>/5</div>
      <button class="btn-secondary" onclick="previousDecorExercise()">‚¨ÖÔ∏è Zr√©ck</button>
      <button class="btn-secondary" onclick="nextDecorExercise()">‚û°Ô∏è Weider</button>
    </div>
    <p class="instructions">
      Wielt eng Faarf, klickt op eng Kugel oder Luucht a fiert se an. Wann all Kugele f√§erdeg sinn, ges√§is du, ob d'L√©isung st√´mmt.
    </p>

    <div class="tree-layout">
      <div class="tree-container">
        <svg id="tree-svg" class="tree-svg" viewBox="0 0 260 340">
          <!-- Background -->
          <rect x="0" y="0" width="260" height="340" fill="#e8f7ec"/>

          <!-- Star -->
          <polygon class="star-shape"
            points="130,18 138,40 162,40 142,53 149,75 130,62 111,75 118,53 98,40 122,40"/>

          <!-- Tree (3 triangles) -->
          <polygon points="130,40 60,130 200,130" fill="#1f6b3a" stroke="#14502a" stroke-width="3"/>
          <polygon points="130,90 50,190 210,190" fill="#1f6b3a" stroke="#14502a" stroke-width="3"/>
          <polygon points="130,150 40,250 220,250" fill="#1f6b3a" stroke="#14502a" stroke-width="3"/>

          <!-- Trunk -->
          <rect x="112" y="250" width="36" height="50" fill="#8b5a2b" stroke="#5c3b1c" stroke-width="3"/>

          <!-- 15 Baubles (class bauble) -->
          <!-- row 1 -->
          <circle class="ornament bauble" data-type="bauble" cx="90" cy="120" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="130" cy="115" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="170" cy="120" r="10"/>

          <!-- row 2 -->
          <circle class="ornament bauble" data-type="bauble" cx="70" cy="160" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="110" cy="165" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="150" cy="165" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="190" cy="160" r="10"/>

          <!-- row 3 -->
          <circle class="ornament bauble" data-type="bauble" cx="60" cy="205" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="95" cy="210" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="130" cy="212" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="165" cy="210" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="200" cy="205" r="10"/>

          <!-- row 4 -->
          <circle class="ornament bauble" data-type="bauble" cx="85" cy="240" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="175" cy="240" r="10"/>
          <circle class="ornament bauble" data-type="bauble" cx="130" cy="240" r="10"/>

          <!-- 10 lights (class light) -->
          <circle class="ornament light" data-type="light" cx="110" cy="90" r="5"/>
          <circle class="ornament light" data-type="light" cx="150" cy="95" r="5"/>

          <circle class="ornament light" data-type="light" cx="80" cy="140" r="5"/>
          <circle class="ornament light" data-type="light" cx="180" cy="140" r="5"/>

          <circle class="ornament light" data-type="light" cx="60" cy="185" r="5"/>
          <circle class="ornament light" data-type="light" cx="200" cy="185" r="5"/>

          <circle class="ornament light" data-type="light" cx="75" cy="225" r="5"/>
          <circle class="ornament light" data-type="light" cx="185" cy="225" r="5"/>

          <circle class="ornament light" data-type="light" cx="115" cy="230" r="5"/>
          <circle class="ornament light" data-type="light" cx="145" cy="230" r="5"/>
        </svg>
      </div>

      <div class="palette-container">
        <div class="exercise-text" id="decor-ex-text"></div>

        <div class="palette-title">1. Wielt eng Faarf:</div>
        <div class="color-palette" id="decor-palette"></div>

        <div class="palette-title">2. Klickt op d'Kugele oder Luuchten.</div>

        <div class="tree-controls">
          <button class="btn-secondary" onclick="resetDecorColors()">üßº Alles l√§schen</button>
          <button onclick="checkDecorSolution()">‚úÖ Kontroll√©ieren</button>
        </div>

        <div class="feedback" id="decor-feedback"></div>
      </div>
    </div>
  </section>
</div>

<script>
  const audioBase = "https://github.com/albrechtclaire1007/p2chreschtdag/raw/refs/heads/main/";

  const items = [
    {
      id: "chreschtbull",
      label: "d'Chr√´schtbull",
      bare: "chreschtbull",
      image: "https://i.postimg.cc/jwp1BMCp/chreschtbull.png",
      audio: "P2_chr√´schtbullen.mp3"
    },
    {
      id: "chreschtluuchten",
      label: "d'Chr√´schtluuchten",
      bare: "chreschtluuchten",
      image: "https://i.postimg.cc/xcS7RpwM/chreschtluuchten.png",
      audio: "P2_chr√´schtluucht.mp3"
    },
    {
      id: "kaddo",
      label: "de Kaddo",
      bare: "kaddo",
      image: "https://i.postimg.cc/3k8qM4JQ/kaddo.png",
      audio: "P2_kaddo.mp3"
    },
    {
      id: "kleeschen",
      label: "de Kleeschen",
      bare: "kleeschen",
      image: "https://i.postimg.cc/PLF9QXHp/kleeschen.png",
      audio: "P2_kleeschen.mp3"
    },
    {
      id: "schnei",
      label: "d'Schn√©i",
      bare: "schnei",
      image: "https://i.postimg.cc/KRyVNp6K/schnei.png",
      audio: "P2_schn√©i.mp3"
    },
    {
      id: "adventskranz",
      label: "den Adventskranz",
      bare: "adventskranz",
      image: "https://i.postimg.cc/nMFbfhVx/adventskranz.png",
      audio: "P2_adventskranz.mp3"
    },
    {
      id: "chreschtbeemchen",
      label: "de Chr√´schtebeemchen",
      bare: "chreschtbeemchen",
      image: "https://i.postimg.cc/QBQPvRR9/chreschtbeemchen.png",
      audio: "P2_chr√´schtbeemchen.mp3"
    },
    {
      id: "engel",
      label: "den Engel",
      bare: "engel",
      image: "https://i.postimg.cc/VrFx03gd/engel.png",
      audio: "P2_engel.mp3"
    },
    {
      id: "kichelchen",
      label: "d'Kichelchen",
      bare: "kichelchen",
      image: "https://i.postimg.cc/xkv7BWWX/kichelchen.png",
      audio: "P2_kichelcher.mp3"
    },
    {
      id: "putsch",
      label: "de Putsch",
      bare: "putsch",
      image: "https://i.postimg.cc/6TWJxp66/putsch.png",
      audio: "P2_Putsch.mp3"
    },
    {
      id: "staer",
      label: "de St√§r",
      bare: "staer",
      image: "https://i.postimg.cc/MMYCfh5c/staer.png",
      audio: "P2_staer.mp3"
    },
    {
      id: "kaerz",
      label: "d'K√§erz",
      bare: "kaerz",
      image: "https://i.postimg.cc/Bv53dHNf/kaerz.png",
      audio: "P2_k√§erz.mp3"
    }
  ];

  function getItem(id) {
    return items.find(i => i.id === id);
  }

  function showScreen(name) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    const screen = document.getElementById('screen-' + name);
    if (screen) screen.classList.add('active');

    if (name === 'lauschter') {
      initLauschter();
    } else if (name === 'memory') {
      startMemoryGame();
    } else if (name === 'schreif') {
      startWriteGame();
    } else if (name === 'raetsel') {
      startRiddleGame();
    } else if (name === 'decor') {
      initDecorGame();
    }
  }

  // ---------- Lauschter a Klick ----------
  let currentListenId = null;
  let lauschterScore = 0;

  function initLauschter() {
    const grid = document.getElementById('lauschter-grid');
    grid.innerHTML = "";
    items.forEach(item => {
      const div = document.createElement('div');
      div.className = 'card clickable-card';
      div.dataset.id = item.id;
      div.innerHTML = `<img src="${item.image}" alt="${item.label}">`;
      div.addEventListener('click', () => handleLauschterClick(item.id, div));
      grid.appendChild(div);
    });
    document.getElementById('lauschter-feedback').textContent = "";
    document.getElementById('lauschter-score').textContent = lauschterScore.toString();
    startLauschterRound();
  }

  function startLauschterRound() {
    const randomItem = items[Math.floor(Math.random() * items.length)];
    currentListenId = randomItem.id;
    document.getElementById('lauschter-feedback').textContent =
      "Lauschter a klick op dat richtegt Bild.";
    resetClickStyles();
    playAudio(randomItem.audio);
  }

  function resetClickStyles() {
    document.querySelectorAll('.clickable-card').forEach(card => {
      card.classList.remove('correct', 'wrong');
    });
  }

  function handleLauschterClick(id, element) {
    if (!currentListenId) return;
    resetClickStyles();
    if (id === currentListenId) {
      element.classList.add('correct');
      lauschterScore++;
      document.getElementById('lauschter-score').textContent = lauschterScore.toString();
      document.getElementById('lauschter-feedback').textContent =
        "Super! Dat ass richteg.";
      setTimeout(startLauschterRound, 1200);
    } else {
      element.classList.add('wrong');
      document.getElementById('lauschter-feedback').textContent =
        "Hmm‚Ä¶ prob√©ier nach eng K√©ier.";
    }
  }

  function playCurrentAudio() {
    if (!currentListenId) return;
    const item = getItem(currentListenId);
    playAudio(item.audio);
  }

  // ---------- Memory ----------
  let memoryCards = [];
  let memoryFirst = null;
  let memoryLock = false;
  let memoryFoundPairs = 0;

  function startMemoryGame() {
    const grid = document.getElementById('memory-grid');
    const feedback = document.getElementById('memory-feedback');
    feedback.textContent = "";
    memoryFoundPairs = 0;
    document.getElementById('memory-found').textContent = "0";

    memoryCards = [];
    items.forEach(item => {
      memoryCards.push({ id: item.id, type: 'image' });
      memoryCards.push({ id: item.id, type: 'word' });
    });

    shuffleArray(memoryCards);
    grid.innerHTML = "";

    memoryCards.forEach((cardData, index) => {
      const card = document.createElement('div');
      card.className = 'memory-card';
      card.dataset.index = index.toString();
      card.dataset.id = cardData.id;
      card.dataset.type = cardData.type;
      card.textContent = "?";
      card.addEventListener('click', () => memoryFlip(card));
      grid.appendChild(card);
    });

    memoryFirst = null;
    memoryLock = false;
  }

  function memoryFlip(card) {
    if (memoryLock) return;
    if (card.classList.contains('matched') || card.classList.contains('revealed')) return;

    revealMemoryCard(card);

    if (!memoryFirst) {
      memoryFirst = card;
    } else {
      const first = memoryFirst;
      const second = card;
      memoryFirst = null;
      memoryLock = true;

      const sameId = first.dataset.id === second.dataset.id;
      const differentType = first.dataset.type !== second.dataset.type;

      if (sameId && differentType) {
        setTimeout(() => {
          first.classList.add('matched');
          second.classList.add('matched');
          memoryLock = false;
          memoryFoundPairs++;
          document.getElementById('memory-found').textContent = memoryFoundPairs.toString();
          if (memoryFoundPairs === items.length) {
            document.getElementById('memory-feedback').textContent =
              "Bravo! Du hues all d'Paaren fonnt.";
          }
        }, 300);
      } else {
        setTimeout(() => {
          hideMemoryCard(first);
          hideMemoryCard(second);
          memoryLock = false;
        }, 700);
      }
    }
  }

  function revealMemoryCard(card) {
    const item = getItem(card.dataset.id);
    card.classList.add('revealed');
    if (card.dataset.type === 'image') {
      card.innerHTML = `<img src="${item.image}" alt="${item.label}">`;
    } else {
      card.textContent = item.label;
    }
  }

  function hideMemoryCard(card) {
    if (card.classList.contains('matched')) return;
    card.classList.remove('revealed');
    card.textContent = "?";
  }

  // ---------- Schreif d'Wuert ----------
  let writeOrder = [];
  let writeIndex = 0;

  function startWriteGame() {
    writeOrder = [...items.map(i => i.id)];
    shuffleArray(writeOrder);
    writeIndex = 0;
    document.getElementById('write-feedback').textContent = "";
    nextWriteRound(true);
  }

  function nextWriteRound(first = false) {
    if (!first) {
      writeIndex++;
      if (writeIndex >= writeOrder.length) {
        writeIndex = 0;
        shuffleArray(writeOrder);
      }
    }
    const currentId = writeOrder[writeIndex];
    const item = getItem(currentId);
    document.getElementById('write-round').textContent = (writeIndex + 1).toString();
    const img = document.getElementById('write-image');
    img.src = item.image;
    img.alt = item.label;
    document.getElementById('write-input').value = "";
    document.getElementById('write-feedback').textContent = "";
  }

  function getCurrentWriteItem() {
    return getItem(writeOrder[writeIndex]);
  }

  function playWriteAudio() {
    const item = getCurrentWriteItem();
    playAudio(item.audio);
  }

  function checkWriteAnswer() {
    const input = document.getElementById('write-input').value.trim();
    const feedback = document.getElementById('write-feedback');
    const item = getCurrentWriteItem();

    if (!input) {
      feedback.textContent = "Schreif e Wuert an.";
      return;
    }

    const normalizedInput = normalizeLux(input);
    const normalizedTarget = normalizeLux(item.bare);

    if (normalizedInput === normalizedTarget) {
      feedback.textContent = "Super geschriwwen!";
      feedback.style.color = "#2f8f46";
    } else {
      feedback.textContent = `Bal richteg‚Ä¶ Hei ass d'L√©isung: "${item.label}".`;
      feedback.style.color = "#c44141";
    }
  }

  // ---------- R√§tselspill ----------
  const riddles = [
    {
      id: "kleeschen",
      text: "Ech hunn e w√§isse Baart. Ech hunn eng rout Mutz. Ech br√©ng Kaddoen."
    },
    {
      id: "chreschtbeemchen",
      text: "Ech si gr√©ng. Ech hu Chr√´schtbullen. Ech hu Chr√´schtluuchten."
    },
    {
      id: "schnei",
      text: "Ech si kal. Ech si w√§iss. Mat mir kanns de e Schn√©im√§nnche maachen."
    },
    {
      id: "adventskranz",
      text: "Ech si gr√©ng. Op mir si 4 K√§erzen, mat deene mir d'Woche bis Chr√´schtdag zielen."
    },
    {
      id: "kichelchen",
      text: "Ech si brong. Mech kanns du iessen. Am flottsten ass et, wann s du mech selwer m√©chs an dekor√©iers."
    },
    {
      id: "kaddo",
      text: "Ech kann all Faarf hunn. Ech hunn e Putsch. De Kleesche br√©ngt mech bei d√©i brav Kanner."
    }
  ];

  let riddleOrder = [];
  let riddleIndex = 0;

  function startRiddleGame() {
    riddleOrder = [...riddles.map(r => r.id)];
    shuffleArray(riddleOrder);
    riddleIndex = 0;
    document.getElementById('riddle-feedback').textContent = "";
    showRiddle();
  }

  function showRiddle() {
    if (riddleIndex >= riddleOrder.length) {
      riddleIndex = 0;
      shuffleArray(riddleOrder);
    }
    const currentId = riddleOrder[riddleIndex];
    const riddle = riddles.find(r => r.id === currentId);
    const textBox = document.getElementById('riddle-text');
    textBox.textContent = riddle.text;
    document.getElementById('riddle-count').textContent = (riddleIndex + 1).toString();

    const imagesDiv = document.getElementById('riddle-images');
    imagesDiv.innerHTML = "";
    const feedback = document.getElementById('riddle-feedback');
    feedback.textContent = "";

    const riddleImageIds = ["kaddo","chreschtbeemchen","kleeschen","schnei","adventskranz","kichelchen"];

    riddleImageIds.forEach(id => {
      const item = getItem(id);
      const card = document.createElement('div');
      card.className = "card riddle-card";
      card.dataset.id = id;
      card.innerHTML = `<img src="${item.image}" alt="${item.label}">`;
      card.addEventListener('click', () => handleRiddleClick(id, card));
      imagesDiv.appendChild(card);
    });
  }

  function handleRiddleClick(id, card) {
    const currentId = riddleOrder[riddleIndex];
    const feedback = document.getElementById('riddle-feedback');

    document.querySelectorAll('.riddle-card').forEach(c => c.classList.remove('correct','wrong'));

    if (id === currentId) {
      card.classList.add('correct');
      feedback.textContent = "Jo, dat ass richteg!";
      feedback.style.color = "#2f8f46";
      setTimeout(() => {
        riddleIndex++;
        showRiddle();
      }, 1200);
    } else {
      card.classList.add('wrong');
      feedback.textContent = "Nee, prob√©ier nach eng K√©ier.";
      feedback.style.color = "#c44141";
    }
  }

  // ---------- Audio helper ----------
  function playAudio(fileName) {
    const url = audioBase + encodeURI(fileName);
    const audio = new Audio(url);
    audio.play().catch(() => {});
  }

  // ---------- Utility ----------
  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function normalizeLux(str) {
    return str
      .toLowerCase()
      .replace(/√§/g, "a")
      .replace(/√´/g, "e")
      .replace(/√©/g, "e")
      .replace(/√Ø/g, "i")
      .replace(/√∂/g, "o")
      .replace(/√º/g, "u")
      .replace(/[^a-z]/g, "");
  }

  // ---------- Decorate Tree ----------
  const decorColors = [
    { id: "green",  label: "gr√©ng",  hex: "#2ecc71" },
    { id: "red",    label: "rout",   hex: "#e74c3c" },
    { id: "blue",   label: "blo",    hex: "#3498db" },
    { id: "yellow", label: "giel",   hex: "#f1c40f" },
    { id: "purple", label: "violett",hex: "#9b59b6" },
    { id: "gold",   label: "g√´llef", hex: "#f4d03f" }
  ];

  // 5 example exercises (only Kugele ginn iwwerpr√©ift)
  const decorExercises = [
    {
      text: "Fierf 5 Kugele gr√©ng, 5 Kugele rout an 5 Kugele blo.",
      targets: { green: 5, red: 5, blue: 5 }
    },
    {
      text: "Fierf 3 Kugele gr√©ng, 4 Kugele rout, 4 Kugele blo an 4 Kugele giel.",
      targets: { green: 3, red: 4, blue: 4, yellow: 4 }
    },
    {
      text: "Fierf 6 Kugele gr√©ng, 3 Kugele rout, 3 Kugele blo an 3 Kugele g√´llef.",
      targets: { green: 6, red: 3, blue: 3, gold: 3 }
    },
    {
      text: "Fierf 2 Kugele gr√©ng, 2 Kugele rout, 2 Kugele blo, 2 Kugele giel an 7 Kugele violett.",
      targets: { green: 2, red: 2, blue: 2, yellow: 2, purple: 7 }
    },
    {
      text: "Fierf 1 Kugel gr√©ng, 2 Kugele rout, 3 Kugele blo, 4 Kugele giel an 5 Kugele g√´llef.",
      targets: { green: 1, red: 2, blue: 3, yellow: 4, gold: 5 }
    }
  ];

  let decorCurrentExercise = 0;
  let decorCurrentColor = decorColors[0].id;
  let decorBaubles = [];
  let decorLights = [];

  function initDecorGame() {
    // Palette
    const paletteDiv = document.getElementById('decor-palette');
    if (!paletteDiv.dataset.initialised) {
      paletteDiv.innerHTML = "";
      decorColors.forEach(color => {
        const div = document.createElement('div');
        div.className = 'palette-color';
        div.style.background = color.hex;
        div.dataset.colorId = color.id;
        div.title = color.label;
        div.addEventListener('click', () => selectDecorColor(color.id));
        paletteDiv.appendChild(div);
      });
      paletteDiv.dataset.initialised = "true";
    }
    selectDecorColor(decorCurrentColor || decorColors[0].id);

    // ornaments
    const svg = document.getElementById('tree-svg');
    decorBaubles = Array.from(svg.querySelectorAll('.ornament.bauble'));
    decorLights  = Array.from(svg.querySelectorAll('.ornament.light'));

    [...decorBaubles, ...decorLights].forEach(el => {
      el.addEventListener('click', () => colorOrnament(el));
    });

    loadDecorExercise();
  }

  function selectDecorColor(colorId) {
    decorCurrentColor = colorId;
    const paletteDiv = document.getElementById('decor-palette');
    paletteDiv.querySelectorAll('.palette-color').forEach(p => {
      p.classList.toggle('selected', p.dataset.colorId === colorId);
    });
  }

  function colorOrnament(el) {
    const color = decorColors.find(c => c.id === decorCurrentColor);
    if (!color) return;
    el.setAttribute('fill', color.hex);
    if (el.dataset.type === "bauble") {
      el.dataset.colorId = color.id;
      // auto-check once all baubles colored
      if (allBaublesColored()) {
        checkDecorSolution(true);
      }
    } else {
      // lights d√ºrfen alles sinn, awer gi net kontroll√©iert
      el.dataset.colorId = color.id;
    }
  }

  function allBaublesColored() {
    return decorBaubles.every(b => !!b.dataset.colorId);
  }

  function resetDecorColors() {
    decorBaubles.forEach(b => {
      b.setAttribute('fill', '#ffffff');
      delete b.dataset.colorId;
    });
    decorLights.forEach(l => {
      l.setAttribute('fill', '#ffffff');
      delete l.dataset.colorId;
    });
    document.getElementById('decor-feedback').textContent = "";
  }

  function loadDecorExercise() {
    const ex = decorExercises[decorCurrentExercise];
    document.getElementById('decor-ex-index').textContent = (decorCurrentExercise + 1).toString();
    document.getElementById('decor-ex-text').textContent = ex.text;
    document.getElementById('decor-feedback').textContent = "";
    resetDecorColors();
  }

  function nextDecorExercise() {
    decorCurrentExercise = (decorCurrentExercise + 1) % decorExercises.length;
    loadDecorExercise();
  }

  function previousDecorExercise() {
    decorCurrentExercise = (decorCurrentExercise - 1 + decorExercises.length) % decorExercises.length;
    loadDecorExercise();
  }

  function checkDecorSolution(auto = false) {
    const feedback = document.getElementById('decor-feedback');
    const ex = decorExercises[decorCurrentExercise];

    if (!allBaublesColored()) {
      if (!auto) {
        feedback.textContent = "Fierf fir d'√©ischt all Kugele, da kanns du kontroll√©ieren.";
        feedback.style.color = "#c44141";
      }
      return;
    }

    const counts = {};
    decorBaubles.forEach(b => {
      const id = b.dataset.colorId || "none";
      counts[id] = (counts[id] || 0) + 1;
    });

    let correct = true;

    decorColors.forEach(color => {
      const target = ex.targets[color.id] || 0;
      const actual = counts[color.id] || 0;
      if (target !== actual) {
        correct = false;
      }
    });

    // assure that there are no unexpected colours (colors with no target but used)
    Object.keys(counts).forEach(colorId => {
      if (colorId === "none") return;
      if (!ex.targets[colorId]) {
        if (counts[colorId] > 0) correct = false;
      }
    });

    if (correct) {
      feedback.textContent = "Super! D'Kugele si genee richteg gefierft. üéâ";
      feedback.style.color = "#2f8f46";
    } else {
      feedback.textContent = "Nach net ganz richteg‚Ä¶ kuck nach eng K√©ier op d'Zuele vun de Faarwen.";
      feedback.style.color = "#c44141";
    }
  }

  // Start default screen
  showScreen('lauschter');
</script>
</body>
</html>

